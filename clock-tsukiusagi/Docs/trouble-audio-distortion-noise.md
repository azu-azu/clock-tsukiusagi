# AVAudioUnitDistortioné›‘éŸ³å•é¡Œ - RCA

**ã‚«ãƒ†ã‚´ãƒª**: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **: ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚·ã‚¹ãƒ†ãƒ ï¼ˆSafeVolumeLimiterï¼‰
**é‡å¤§åº¦**: Criticalï¼ˆã™ã¹ã¦ã®éŸ³å£°ãŒé›‘éŸ³åŒ–ï¼‰
**ä½œæˆæ—¥**: 2025-11-13
**æœ€çµ‚æ›´æ–°**: 2025-11-13

---

## ğŸ“‹ æ¦‚è¦

ã™ã¹ã¦ã®éŸ³å£°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿãƒ»åˆæˆéŸ³æºï¼‰ãŒé›‘éŸ³ã®ã‚ˆã†ã«èã“ãˆã‚‹å•é¡ŒãŒç™ºç”Ÿã€‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã‚„ãƒãƒƒãƒ•ã‚¡ã®å•é¡Œã ã¨æ€ã‚ã‚ŒãŸãŒã€å®Ÿéš›ã¯ **SafeVolumeLimiter** ã§ä½¿ç”¨ã—ã¦ã„ãŸ **AVAudioUnitDistortion** ã® **multiDecimated4** ãƒ—ãƒªã‚»ãƒƒãƒˆãŒåŸå› ã ã£ãŸã€‚

---

## ğŸ”´ å•é¡Œã®ç—‡çŠ¶

### å ±å‘Šã•ã‚ŒãŸç—‡çŠ¶

- ã™ã¹ã¦ã®éŸ³å£°ãŒã€Œé›‘éŸ³ã®ã‚ˆã†ãªéŸ³ã€ã«èã“ãˆã‚‹
- ã‚¶ãƒ©ã‚¶ãƒ©ã—ãŸéŸ³è³ªã€lo-fi/ãƒ“ãƒƒãƒˆã‚¯ãƒ©ãƒƒã‚·ãƒ£ãƒ¼çš„ãªéŸ³
- ãƒã‚¤ã‚ºãŒæ··ã–ã£ãŸã‚ˆã†ãªèã“ãˆæ–¹
- ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿã‚‚åˆæˆéŸ³æºï¼ˆClickSuppressionDroneï¼‰ã‚‚ä¸¡æ–¹ã¨ã‚‚å½±éŸ¿

### é‡è¦ãªè¨ºæ–­æƒ…å ±

âœ… **æ±ºå®šçš„ã ã£ãŸæƒ…å ±**:
```
ã€ŒiPhoneã§ç›´æ¥å†ç”Ÿã™ã‚‹ã¨ã€ã¡ã‚ƒã‚“ã¨ã—ãŸéŸ³ã§èã“ãˆã‚‹ã€
ã€Œã‚¯ãƒªãƒƒã‚¯éŸ³é˜²æ­¢ã®æ–¹ã‚‚æœ¬æ¥ã®éŸ³ã§ã¯ãªã„æ°—ãŒã™ã‚‹ã€
```

ã“ã®2ã¤ã®æƒ…å ±ã‹ã‚‰ï¼š
- WAVãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã¯æ­£å¸¸ âœ…
- iPhoneã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¯æ­£å¸¸ âœ…
- ã™ã¹ã¦ã®éŸ³æºãŒå½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹ â†’ **å…±é€šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å•é¡Œ** âŒ

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æï¼ˆRCAï¼‰

### åŸå› 

`SafeVolumeLimiter.swift` ã® `updateLimiterSettings()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€éŸ³é‡åˆ¶é™ã®ãŸã‚ã« **AVAudioUnitDistortion** ã® **multiDecimated4** ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ãŸã€‚

```swift
// âŒ å•é¡Œã®ã‚ã£ãŸã‚³ãƒ¼ãƒ‰ (SafeVolumeLimiter.swift:157-168)
private func updateLimiterSettings() {
    // iOSç”¨ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è¨­å®š
    // AVAudioUnitDistortionã‚’ä½¿ç”¨ã—ã¦ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆã‚’å®Ÿç¾
    // è² ã®ãƒ—ãƒªã‚²ã‚¤ãƒ³ + ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã§ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã«è¿‘ã„åŠ¹æœã‚’å¾—ã‚‹

    limiterNode.loadFactoryPreset(.multiDecimated4)  // â† ã“ã‚ŒãŒé›‘éŸ³ã®åŸå› ï¼

    // ãƒ—ãƒªã‚²ã‚¤ãƒ³: maxOutputDbã«åŸºã¥ã„ã¦èª¿æ•´ï¼ˆ-6dB â†’ ç´„-6dB gainï¼‰
    limiterNode.preGain = maxOutputDb

    // ã‚¦ã‚§ãƒƒãƒˆãƒ‰ãƒ©ã‚¤ãƒŸãƒƒã‚¯ã‚¹: 100%ã‚¦ã‚§ãƒƒãƒˆï¼ˆå®Œå…¨ã«å‡¦ç†ã‚’é©ç”¨ï¼‰
    limiterNode.wetDryMix = 100
}
```

### ãªãœé›‘éŸ³ã«ãªã‚‹ã®ã‹

**multiDecimated4** ãƒ—ãƒªã‚»ãƒƒãƒˆã®ç‰¹æ€§ï¼š
- **Decimationï¼ˆãƒ‡ã‚·ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰** = ã‚µãƒ³ãƒ—ãƒ«ã®é–“å¼•ãå‡¦ç†
- ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚µãƒ³ãƒ—ãƒ«ã‚’æ„å›³çš„ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã€Œlo-fiã€åŠ¹æœã‚’ä½œã‚‹
- ã‚®ã‚¿ãƒ¼ã‚„ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼ã®ç‰¹æ®Šã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨ã—ã¦ã¯æœ‰ç”¨
- **éŸ³é‡åˆ¶é™ã«ã¯å®Œå…¨ã«ä¸é©åˆ‡**

ã™ã¹ã¦ã®éŸ³å£°ãŒã“ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é€šéã™ã‚‹ãŸã‚ã€ã‚¯ãƒªã‚¢ãªéŸ³å£°ãŒç ´å£Šã•ã‚Œã¦é›‘éŸ³ã®ã‚ˆã†ã«èã“ãˆã¦ã„ãŸã€‚

### éŸ³å£°å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
TrackPlayerï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿï¼‰
    â†“
masterBusMixer
    â†“
SafeVolumeLimiterï¼ˆAVAudioUnitDistortion: multiDecimated4ï¼‰â† ã“ã“ã§ç ´å£Šï¼
    â†“
mainMixerNode
    â†“
outputNode
```

```
ClickSuppressionDroneï¼ˆåˆæˆéŸ³æºï¼‰
    â†“
masterBusMixer
    â†“
SafeVolumeLimiterï¼ˆAVAudioUnitDistortion: multiDecimated4ï¼‰â† ã“ã“ã§ç ´å£Šï¼
    â†“
mainMixerNode
    â†“
outputNode
```

**ä¸¡æ–¹ã®éŸ³æºãŒåŒã˜ SafeVolumeLimiter ã‚’é€šéã™ã‚‹ãŸã‚ã€ã™ã¹ã¦ã®éŸ³ãŒé›‘éŸ³åŒ–ã—ã¦ã„ãŸã€‚**

### ãªãœã“ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã£ã¦ã„ãŸã‹

ã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰æ¨æ¸¬ã•ã‚Œã‚‹è¨­è¨ˆæ„å›³ï¼š

> iOSç”¨ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°è¨­å®š
> AVAudioUnitDistortionã‚’ä½¿ç”¨ã—ã¦ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆã‚’å®Ÿç¾
> è² ã®ãƒ—ãƒªã‚²ã‚¤ãƒ³ + ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã§ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã«è¿‘ã„åŠ¹æœã‚’å¾—ã‚‹

**å•é¡Œç‚¹**:
- macOSã§ã¯ `AVAudioUnitDynamicsProcessor`ï¼ˆæœ¬ç‰©ã®ã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚µãƒ¼/ãƒªãƒŸãƒƒã‚¿ãƒ¼ï¼‰ãŒä½¿ãˆã‚‹
- iOSã§ã¯ä½¿ãˆãªã„ãŸã‚ã€ä»£æ›¿ã¨ã—ã¦ `AVAudioUnitDistortion` ã‚’é¸æŠ
- ã—ã‹ã—ã€**Distortion ã¯éŸ³ã‚’æ­ªã¾ã›ã‚‹ãŸã‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ**ã§ã‚ã‚Šã€éŸ³é‡åˆ¶é™ã«ã¯ä¸é©åˆ‡

---

## ğŸ”§ èª¤ã£ãŸè¨ºæ–­ã®çµŒç·¯

### è©¦è¡ŒéŒ¯èª¤ã®ãƒ—ãƒ­ã‚»ã‚¹

| ã‚¹ãƒ†ãƒƒãƒ— | ä»®èª¬ | å®Ÿæ–½ã—ãŸå¯¾ç­– | çµæœ |
|---------|------|-------------|------|
| 1 | CAFãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé›£ã—ã„ | WAVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«çµ±ä¸€ | âŒ å¤‰ã‚ã‚‰ãš |
| 2 | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸ä¸€è‡´ï¼ˆInt16 vs Float32ï¼‰ | TrackPlayerã§æ‰‹å‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã‚’å®Ÿè£… | âŒ å¤‰ã‚ã‚‰ãš |
| 3 | AVAudioConverterã®ä½¿ã„æ–¹ãŒé–“é•ã£ã¦ã„ã‚‹ | Converterã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ã‚’ä¿®æ­£ | âŒ å¤‰ã‚ã‚‰ãš |
| 4 | ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›è‡ªä½“ãŒä¸è¦ | AVAudioEngineã®è‡ªå‹•å¤‰æ›ã«ä»»ã›ã‚‹ | âŒ å¤‰ã‚ã‚‰ãš |
| 5 | **å…±é€šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆSafeVolumeLimiterï¼‰ã‚’ç¢ºèª** | ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¨­å®šã‚’ç¢ºèª â†’ **åŸå› ç™ºè¦‹** | âœ… è§£æ±ºï¼ |

### ãªãœç™ºè¦‹ãŒé…ã‚ŒãŸã‹

1. **ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã«æ³¨ç›®ã—ã™ããŸ**
   - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã€ãƒãƒƒãƒ•ã‚¡å‡¦ç†ã€ãƒãƒ£ãƒ³ãƒãƒ«æ•°ãªã©
   - ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå‡¦ç†ã¨ã„ã†ã€ŒåŠ å·¥ã€ã®è¦–ç‚¹ãŒæ¬ ã‘ã¦ã„ãŸ

2. **è¤‡é›‘ãªè§£æ±ºç­–ã‚’å…ˆã«è©¦ã—ãŸ**
   - ã‚·ãƒ³ãƒ—ãƒ«ãªã€Œã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ãƒ†ã‚¹ãƒˆã€ã‚’æœ€åˆã«ã™ã¹ãã ã£ãŸ

3. **ã™ã¹ã¦ã®éŸ³æºãŒå½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹äº‹å®Ÿã‚’è¦‹è½ã¨ã—ãŸ**
   - ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿã ã‘ã§ãªãã€åˆæˆéŸ³æºã‚‚é›‘éŸ³
   - æœ€åˆã‹ã‚‰ã€Œå…±é€šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€ã‚’ç–‘ã†ã¹ãã ã£ãŸ

---

## âœ… è§£æ±ºç­–

### æš«å®šå¯¾å¿œï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å®Œå…¨ã«ãƒã‚¤ãƒ‘ã‚¹ï¼š

```swift
// âœ… ä¿®æ­£å¾Œ (SafeVolumeLimiter.swift:157-168)
private func updateLimiterSettings() {
    // TEMPORARY FIX: Bypass distortion effect entirely
    // The multiDecimated4 preset was causing noise/artifacts
    // TODO: Find proper limiter solution for iOS (AVAudioUnitEQ or custom gain control)

    // Bypass the effect by setting wet/dry mix to 0% (100% dry = no processing)
    limiterNode.wetDryMix = 0

    print("   âš ï¸  LIMITER BYPASSED (distortion was causing noise)")
    print("   Pre-gain: \(maxOutputDb) dB (not applied)")
    print("   Wet/Dry: 0% (bypass mode)")
}
```

**wetDryMix ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `0` = 100% Dryï¼ˆå…ƒã®éŸ³å£°ãã®ã¾ã¾ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãªã—ï¼‰
- `100` = 100% Wetï¼ˆ100%ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨ï¼‰

**çµæœ**:
- ã™ã¹ã¦ã®éŸ³å£°ãŒã‚¯ãƒªã‚¢ã«èã“ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸ âœ…
- ãŸã ã—éŸ³é‡åˆ¶é™æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼ˆTODOï¼‰

### æ’ä¹…å¯¾å¿œï¼ˆTODOï¼‰

éŸ³é‡åˆ¶é™æ©Ÿèƒ½ã‚’æ­£ã—ãå®Ÿè£…ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¤œè¨ï¼š

#### Option 1: AVAudioMixerNode ã® volume ã§åˆ¶å¾¡ï¼ˆæ¨å¥¨ï¼‰

```swift
// ã‚·ãƒ³ãƒ—ãƒ«ã§åŠ¹æœçš„
public func configure(engine: AVAudioEngine, format: AVAudioFormat) {
    // ... existing setup ...

    // Set volume limit on masterBusMixer
    let linearGain = pow(10.0, maxOutputDb / 20.0)  // dB â†’ linear
    masterBusMixer.outputVolume = min(1.0, linearGain)

    print("ğŸ”Š [SafeVolumeLimiter] Volume limit: \(maxOutputDb) dB (linear: \(linearGain))")
}
```

**åˆ©ç‚¹**:
- ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿ
- CPUè² è·ãŒä½ã„
- éŸ³è³ªã¸ã®å½±éŸ¿ãªã—

**æ¬ ç‚¹**:
- ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã«ãªã‚‹ï¼ˆ-6dBã‚’è¶…ãˆã‚‹éŸ³ã¯å˜ç´”ã«ã‚«ãƒƒãƒˆï¼‰
- ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆåŠ¹æœã¯ãªã„

#### Option 2: AVAudioUnitEQ ã§ã‚²ã‚¤ãƒ³èª¿æ•´

```swift
private let eqNode = AVAudioUnitEQ(numberOfBands: 1)

public func configure(engine: AVAudioEngine, format: AVAudioFormat) {
    // ... existing setup ...

    engine.attach(eqNode)

    // Configure EQ as gain control
    eqNode.bands[0].filterType = .parametric
    eqNode.bands[0].frequency = 1000  // Center frequency (not critical for gain)
    eqNode.bands[0].bandwidth = 2.0   // Wide bandwidth
    eqNode.bands[0].gain = maxOutputDb  // -6dB ç­‰
    eqNode.bypass = false

    // Connect: masterBusMixer â†’ EQ â†’ mainMixer
    engine.connect(masterBusMixer, to: eqNode, format: format)
    engine.connect(eqNode, to: engine.mainMixerNode, format: nil)
}
```

**åˆ©ç‚¹**:
- EQãƒãƒ¼ãƒ‰ã¯iOSã§å®‰å®šã—ã¦ã„ã‚‹
- éŸ³è³ªã¸ã®å½±éŸ¿ãŒå°‘ãªã„

**æ¬ ç‚¹**:
- ãƒªãƒŸãƒƒã‚¿ãƒ¼ã§ã¯ãªãã‚²ã‚¤ãƒ³èª¿æ•´ï¼ˆ-6dBã‚’è¶…ãˆã‚‹éŸ³ã¯æ­ªã‚€å¯èƒ½æ€§ï¼‰

#### Option 3: æ‰‹å‹•ã®ãƒãƒƒãƒ•ã‚¡å‡¦ç†ã§ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°

```swift
// installTap ã‚’ä½¿ã£ã¦ãƒãƒƒãƒ•ã‚¡ã‚’åŠ å·¥
masterBusMixer.installTap(onBus: 0, bufferSize: 4096, format: format) { buffer, time in
    // Soft clipping algorithm
    if let floatChannelData = buffer.floatChannelData {
        for channel in 0..<Int(buffer.format.channelCount) {
            let samples = floatChannelData[channel]
            for frame in 0..<Int(buffer.frameLength) {
                let sample = samples[frame]
                // Soft clip: tanh(x) for smooth limiting
                samples[frame] = tanh(sample * threshold)
            }
        }
    }
}
```

**åˆ©ç‚¹**:
- å®Œå…¨ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
- ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆåŠ¹æœã‚’å®Ÿç¾å¯èƒ½

**æ¬ ç‚¹**:
- CPUè² è·ãŒé«˜ã„
- å®Ÿè£…ãŒè¤‡é›‘
- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãŒå¢—åŠ ã™ã‚‹å¯èƒ½æ€§

### æ¨å¥¨: Option 1ï¼ˆAVAudioMixerNode.volumeï¼‰

ç¾æ™‚ç‚¹ã§ã¯ **Option 1** ã‚’æ¨å¥¨ã—ã¾ã™ï¼š
- ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿ
- éŸ³è³ªã¸ã®å½±éŸ¿ãªã—
- è¿½åŠ ã®CPUè² è·ãªã—

ã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆåŠ¹æœãŒå¿…è¦ãªå ´åˆã¯ã€Option 3 ã‚’æ¤œè¨ã€‚

---

## ğŸ“Š ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒ

| çŠ¶æ…‹ | éŸ³è³ª | éŸ³é‡åˆ¶é™ | CPUè² è· |
|------|------|----------|---------|
| **ä¿®æ­£å‰** | é›‘éŸ³ï¼ˆãƒ‡ã‚·ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœï¼‰ | ç„¡åŠ¹ï¼ˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç ´å£Šçš„ï¼‰ | ä¸­ |
| **ä¿®æ­£å¾Œï¼ˆæš«å®šï¼‰** | ã‚¯ãƒªã‚¢ï¼ˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒã‚¤ãƒ‘ã‚¹ï¼‰ | ç„¡åŠ¹ï¼ˆTODOï¼‰ | ä½ |
| **ç†æƒ³ï¼ˆOption 1ï¼‰** | ã‚¯ãƒªã‚¢ | æœ‰åŠ¹ï¼ˆãƒãƒ¼ãƒ‰ãƒªãƒŸãƒƒãƒˆï¼‰ | ä½ |
| **ç†æƒ³ï¼ˆOption 3ï¼‰** | ã‚¯ãƒªã‚¢ | æœ‰åŠ¹ï¼ˆã‚½ãƒ•ãƒˆãƒªãƒŸãƒƒãƒˆï¼‰ | é«˜ |

---

## ğŸ’¡ é‡è¦ãªæ•™è¨“

### 1. ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ç›®çš„ã‚’ç†è§£ã™ã‚‹

| ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ | ç›®çš„ | ç”¨é€” |
|----------|------|------|
| **Distortion** | éŸ³ã‚’æ­ªã¾ã›ã‚‹ | ã‚®ã‚¿ãƒ¼ã€ã‚·ãƒ³ã‚»ã€ç‰¹æ®ŠåŠ¹æœ |
| **Dynamics Processor** | éŸ³é‡ã‚’åˆ¶å¾¡ã™ã‚‹ | ãƒã‚¹ã‚¿ãƒªãƒ³ã‚°ã€éŸ³é‡åˆ¶é™ |
| **EQ** | å‘¨æ³¢æ•°ç‰¹æ€§ã‚’èª¿æ•´ã™ã‚‹ | ãƒˆãƒ¼ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã€ã‚²ã‚¤ãƒ³èª¿æ•´ |

**é–“é•ã„**: Distortion ã‚’éŸ³é‡åˆ¶é™ã«ä½¿ã†
**æ­£è§£**: Dynamics Processor ã¾ãŸã¯ Mixer Volume ã‚’ä½¿ã†

### 2. å•é¡Œã®åˆ‡ã‚Šåˆ†ã‘ã¯å¤–å´ã‹ã‚‰å†…å´ã¸

```
âŒ é–“é•ã£ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š
   ãƒ‡ãƒ¼ã‚¿ â†’ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ â†’ å¤‰æ› â†’ ãƒãƒƒãƒ•ã‚¡
   ï¼ˆæœ€ã‚‚æ·±ã„éƒ¨åˆ†ã‹ã‚‰èª¿æŸ»ï¼‰

âœ… æ­£ã—ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š
   ãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã¯æ­£å¸¸ã‹ï¼Ÿ â†’ YES
   ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¯æ­£å¸¸ã‹ï¼Ÿ â†’ YES
   ã‚¢ãƒ—ãƒªã®å‡¦ç†ã«å•é¡Œï¼Ÿ â†’ YES
   ã©ã®å‡¦ç†ã§å£Šã‚Œã‚‹ï¼Ÿ â†’ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼
```

### 3. ã€Œã™ã¹ã¦ã®ç—‡çŠ¶ã«å…±é€šã™ã‚‹éƒ¨åˆ†ã€ã‚’æ¢ã™

- ãƒ•ã‚¡ã‚¤ãƒ«å†ç”ŸãŒé›‘éŸ³ â† TrackPlayerãŒåŸå› ï¼Ÿ
- ã‚¯ãƒªãƒƒã‚¯éŸ³é˜²æ­¢ã‚‚é›‘éŸ³ â† ClickSuppressionDroneã‚‚åŸå› ï¼Ÿ
- **ä¸¡æ–¹ã¨ã‚‚é›‘éŸ³** â† **å…±é€šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆSafeVolumeLimiterï¼‰ãŒåŸå› ï¼**

### 4. ã‚·ãƒ³ãƒ—ãƒ«ãªè¨ºæ–­ã‚’æœ€åˆã«è©¦ã™

è¤‡é›‘ãªå¤‰æ›å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹å‰ã«ï¼š

```swift
// ã¾ãšãƒã‚¤ãƒ‘ã‚¹ã—ã¦ãƒ†ã‚¹ãƒˆ
limiterNode.bypass = true  // ã¾ãŸã¯
limiterNode.wetDryMix = 0
```

ã“ã‚Œã§éŸ³ãŒã‚¯ãƒªã‚¢ã«ãªã‚Œã°ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒåŸå› ã ã¨ã™ãåˆ†ã‹ã‚‹ã€‚

### 5. ãƒ—ãƒªã‚»ãƒƒãƒˆåã¯é‡è¦ãªãƒ’ãƒ³ãƒˆ

- `multiDecimated4` - **ã€ŒDecimatedã€ã‹ã‚‰é–“å¼•ãå‡¦ç†ã ã¨æ¨æ¸¬ã§ãã‚‹**
- `SoftClipping` - ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°å‡¦ç†
- `DynamicsProcessor` - éŸ³é‡åˆ¶å¾¡

åå‰ã‹ã‚‰å‹•ä½œã‚’æ¨æ¸¬ã§ãã‚‹ã€‚Appleã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ãƒ—ãƒªã‚»ãƒƒãƒˆã®åŠ¹æœã‚’ç¢ºèªã™ã¹ãã€‚

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒåŸå› ã‹ç¢ºèªã™ã‚‹

```swift
// SafeVolumeLimiter.swift ã® updateLimiterSettings() ã«è¿½åŠ 
print("ğŸ” [Debug] Preset: \(limiterNode.presetName ?? "none")")
print("ğŸ” [Debug] WetDryMix: \(limiterNode.wetDryMix)")
print("ğŸ” [Debug] PreGain: \(limiterNode.preGain)")
print("ğŸ” [Debug] Bypass: \(limiterNode.bypass)")
```

**å•é¡Œã®ã‚ã‚‹å€¤**:
- Preset: `multiDecimated4` ã¾ãŸã¯ä»–ã®ãƒ‡ã‚·ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç³»
- WetDryMix: `100`ï¼ˆ100%ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé©ç”¨ï¼‰
- Bypass: `false`

**ãƒ†ã‚¹ãƒˆæ–¹æ³•**:

```swift
// ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä¸€æ™‚çš„ã«ãƒã‚¤ãƒ‘ã‚¹
limiterNode.bypass = true
// ã¾ãŸã¯
limiterNode.wetDryMix = 0

// éŸ³ãŒã‚¯ãƒªã‚¢ã«ãªã‚Œã°ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒåŸå› 
```

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [TrackPlayerå®Ÿè£…ãƒãƒ¼ãƒˆ](../../../docs/TrackPlayer-Implementation-Notes.md) - ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€Œ10. AVAudioUnitDistortion ã«ã‚ˆã‚‹é›‘éŸ³å•é¡Œã€
- `SafeVolumeLimiter.swift` - éŸ³é‡åˆ¶é™ã®å®Ÿè£…
- `AudioService.swift` - ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆ

---

## ğŸ”— é–¢é€£ã‚³ãƒŸãƒƒãƒˆ

- Commit: `[æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥]` - "fix: bypass AVAudioUnitDistortion to prevent noise artifacts"

---

## ğŸ“ æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | æ›´æ–°è€… |
|------|---------|--------|
| 2025-11-13 | åˆç‰ˆä½œæˆï¼ˆRCAå®Œäº†ã€æš«å®šå¯¾å¿œå®Ÿæ–½æ¸ˆã¿ï¼‰ | Claude Code |

---

**ä½œæˆè€…**: Claude Code
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: æœªå®Ÿæ–½
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æš«å®šå¯¾å¿œå®Œäº†ã€æ’ä¹…å¯¾å¿œTODO
