# Audio Smoothness Guide â€” éŸ³ã®ã€Œæ»‘ã‚‰ã‹ã•ã€è¨­è¨ˆã‚¬ã‚¤ãƒ‰

**Version**: 1.2
**Last Updated**: 2025-11-30
**Purpose**: TsukiSoundã«ãŠã‘ã‚‹ã€Œæ»‘ã‚‰ã‹ã•ã€ã®è¨­è¨ˆãƒ«ãƒ¼ãƒ«ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

---

## What is Smoothness? â€” æ»‘ã‚‰ã‹ã•ã¨ã¯

> æ»‘ã‚‰ã‹ã•ã¨ã¯ã€éŸ³é‡ãƒ»å‘¨æ³¢æ•°ãƒ»æ³¢å½¢ãŒ
> *é€£ç¶šçš„ã«å¤‰åŒ–ã—ã¦ã„ã‚‹* ã¨è€³ãŒèªè­˜ã™ã‚‹çŠ¶æ…‹ã®ã“ã¨ã€‚
> éŸ³ã¯ã€Œé€£ç¶šã€ãŒå´©ã‚Œã‚‹ã¨ãƒã‚¤ã‚ºã«ãªã‚‹ã€‚

---

## ğŸ”¥ æ»‘ã‚‰ã‹ã• 3å¤§ãƒ«ãƒ¼ãƒ«ï¼ˆæœ€å„ªå…ˆï¼‰

å®Ÿè£…ä¸­ã«ã™ã¹ã¦ã‚’æ°—ã«ã§ããªã„ã¨ãã¯ã€ã“ã®3ã¤ã ã‘ã¯å®ˆã‚‹ï¼š

1. **attack = 0 ã‚’çµ¶å¯¾ã«ä½¿ã‚ãªã„** â€” å¿…ãšã‚¯ãƒªãƒƒã‚¯éŸ³ãŒç™ºç”Ÿã™ã‚‹
2. **cutoff / Q ã‚’æ€¥ã«å‹•ã‹ã•ãªã„** â€” ãƒ•ã‚£ãƒ«ã‚¿ç™ºæŒ¯ã®åŸå› 
3. **ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ã‚’å¿…ãšæƒãˆã‚‹** â€” é–‹å§‹ãƒ»çµ‚äº†ç‚¹ã§ã®ãƒ‘ãƒãƒ‘ãƒéŸ³ã‚’é˜²æ­¢

---

## Overview

éŸ³ã®æ»‘ã‚‰ã‹ã•ã¯ã€**4ã¤ã®å±¤**ã§å®ˆã‚‰ã‚Œã¾ã™ï¼š

1. **Wave Smoothness** â€” æ³¢å½¢ãƒ¬ãƒ™ãƒ«ã®æ»‘ã‚‰ã‹ã•
2. **Envelope Smoothness** â€” ç«‹ã¡ä¸ŠãŒã‚Šãƒ»æ¸›è¡°ã®æ»‘ã‚‰ã‹ã•
3. **Parameter Smoothness** â€” ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰åŒ–ã®æ»‘ã‚‰ã‹ã•
4. **Structural Smoothness** â€” æ§‹é€ ãƒ¬ãƒ™ãƒ«ã§ã®æ»‘ã‚‰ã‹ã•

æ€¥æ¿€ãªå¤‰åŒ–ã¯å¸¸ã«ãƒã‚¤ã‚ºï¼ˆã‚¯ãƒªãƒƒã‚¯ã€ãƒãƒƒãƒ—ã€æ­ªã¿ï¼‰ã®åŸå› ã«ãªã‚Šã¾ã™ã€‚

---

## 1. Wave Smoothnessï¼ˆæ³¢å½¢ã®æ»‘ã‚‰ã‹ã•ï¼‰

### ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ã§åˆ‡ã‚Šæ›¿ãˆã‚‹

- é–‹å§‹ãƒ»çµ‚äº†ãƒã‚¤ãƒ³ãƒˆã¯å¿…ãš **åŒã˜ç¬¦å·ã®ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹** ã«æƒãˆã‚‹
- éŸ³é‡ã‚¼ãƒ­ã®ç›´å‰ã«æ€¥ãªãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚‹ã¨ â†’ ãƒ‘ãƒãƒ‘ãƒéŸ³ã®åŸå› 

**ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ã®ä¾‹ï¼ˆASCIIå›³ï¼‰**:
```
æ³¢å½¢ A (çµ‚äº†ç‚¹)          æ³¢å½¢ B (é–‹å§‹ç‚¹)
        â†“                    â†“
    +   â”‚   â•­â”€â”€â”€            â•­â”€â”€â”€â•®
    0 â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€   â†’   â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€
    -   â”‚   â†‘               â†‘
            ã“ã“ã§ã‚¼ãƒ­      ã“ã“ã§ã‚¼ãƒ­

âœ… è‰¯ã„ä¾‹: ä¸¡æ–¹ã‚¼ãƒ­ & åŒã˜æ–¹å‘ï¼ˆä¸Šæ˜‡ä¸­ï¼‰ã§åˆ‡ã‚Šæ›¿ãˆ
           â†’ æ³¢å½¢ãŒè‡ªç„¶ã«ç¹‹ãŒã‚‹

âŒ æ‚ªã„ä¾‹:
    +   â”‚   â•­â”€â”€â”€â•®           â•­â”€â”€â”€â•®
    0 â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€   â†’   â”€â”¼â”€â”€â”€â”¼â”€â”€â”€
    -   â”‚       â†‘           â†‘
                ãƒ”ãƒ¼ã‚¯      ã‚¼ãƒ­

    â†’ æŒ¯å¹…ãŒæ€¥å¤‰ã—ã¦ã‚¯ãƒªãƒƒã‚¯éŸ³ç™ºç”Ÿ
```

### ãƒ•ã‚§ãƒ¼ãƒ‰ã¯é©åˆ‡ãªé•·ã•ã§

| é•·ã• | çµæœ |
|------|------|
| 0ms | ã‚¯ãƒªãƒƒã‚¯éŸ³ç™ºç”Ÿ |
| 3ã€œ20ms | é©åˆ‡ |
| é•·ã™ãã‚‹ | ä¸è‡ªç„¶ãªã€Œå¸ã„è¾¼ã¾ã‚Œæ„Ÿã€ |

**TsukiSoundæ¨å¥¨å€¤**:
- ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³: 10ã€œ70ms
- ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ: 50ã€œ200ms

---

## 2. Envelope Smoothnessï¼ˆç«‹ã¡ä¸ŠãŒã‚Šãƒ»æ¸›è¡°ï¼‰

### attack = 0 ã¯ç¦æ­¢

**ä¾‹å¤–ãªãã‚¯ãƒªãƒƒã‚¯éŸ³ãŒç™ºç”Ÿã—ã¾ã™ã€‚**

SignalEnvelopeUtils ã§å®šç¾©ã•ã‚ŒãŸæ¨å¥¨ã‚¢ã‚¿ãƒƒã‚¯æ™‚é–“ï¼š

| å‘¨æ³¢æ•°å¸¯åŸŸ | æ¨å¥¨ã‚¢ã‚¿ãƒƒã‚¯æ™‚é–“ | å®šæ•° |
|-----------|------------------|------|
| é«˜éŸ³ï¼ˆ500Hzä»¥ä¸Šï¼‰ | 30ms (0.03s) | `AttackTime.high` |
| ä¸­éŸ³ï¼ˆ200-500Hzï¼‰ | 60ms (0.06s) | `AttackTime.mid` |
| ä½éŸ³ï¼ˆ200Hzä»¥ä¸‹ï¼‰ | 120ms (0.12s) | `AttackTime.low` |

**Quick Lookup Tableï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰**:
```
Freq range   | Attack (sec) | Attack (ms)
-------------|--------------|------------
High  >500Hz |    >= 0.03   |   >= 30ms
Mid  200-500 |    >= 0.06   |   >= 60ms
Low   <200Hz |    >= 0.12   |   >= 120ms
```

**ãªãœä½éŸ³ã»ã©é•·ã„ã‚¢ã‚¿ãƒƒã‚¯ãŒå¿…è¦ã‹**:
- ä½å‘¨æ³¢ã®æ³¢å½¢ã¯1å‘¨æœŸãŒé•·ã„
- ååˆ†ãªå‘¨æœŸæ•°ãŒãªã„ã¨ã€ç«‹ã¡ä¸ŠãŒã‚ŠãŒã‚¯ãƒªãƒƒã‚¯ã¨ã—ã¦èã“ãˆã‚‹
- ä¾‹: 100Hzã¯1å‘¨æœŸ10ms â†’ ã‚¢ã‚¿ãƒƒã‚¯120msã§12å‘¨æœŸåˆ†ç¢ºä¿

### sinÂ²ã‚«ãƒ¼ãƒ–ã§ã‚¢ã‚¿ãƒƒã‚¯

ç·šå½¢ã‚ˆã‚ŠæŒ‡æ•°/sinÂ²ã‚«ãƒ¼ãƒ–ã®æ–¹ãŒè‡ªç„¶ã«è´ã“ãˆã¾ã™ï¼š

```swift
// SignalEnvelopeUtils.smoothEnvelope ã®å®Ÿè£…
if t < attack {
    let p = t / attack
    let s = sin(p * Float.pi * 0.5)
    return s * s  // sinÂ²ã‚«ãƒ¼ãƒ–
}
```

### release ã¯éŸ³æ¥½çš„ã«æ±ºã‚ã‚‹

| éŸ³æºã‚¿ã‚¤ãƒ— | æ¨å¥¨ãƒªãƒªãƒ¼ã‚¹ |
|-----------|-------------|
| ãƒ¡ãƒ­ãƒ‡ã‚£ç³» | 0.1ã€œ0.2ç§’ |
| Pads/Ambience | 0.3ã€œ1.5ç§’ |
| ãƒ‘ãƒ¼ã‚«ãƒƒã‚·ãƒ§ãƒ³ | 0.05ã€œ0.1ç§’ |

### Envelope ã®æ€¥å¤‰ã¯ç¦æ­¢

- ã‚¢ã‚¿ãƒƒã‚¯/ãƒªãƒªãƒ¼ã‚¹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€”ä¸­ã§å¤‰æ›´ã—ãªã„
- å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€éŸ³ã®å¢ƒç•Œï¼ˆå°ç¯€ã®åŒºåˆ‡ã‚Šç­‰ï¼‰ã§è¡Œã†

---

## 3. Parameter Smoothnessï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰åŒ–ã®æ»‘ã‚‰ã‹ã•ï¼‰

### å€¤ã‚’ "çªç„¶" å¤‰ãˆãªã„

ä»¥ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯æ€¥æ¿€ã«å¤‰åŒ–ã•ã›ã¦ã¯ã„ã‘ã¾ã›ã‚“ï¼š

- `volume` / `gain`
- `cutoff` / `resonance` (ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼)
- `harmonicAmplitudes` (å€éŸ³æ§‹æˆ)
- `pan` / `balance`

ã™ã¹ã¦ã®å¤‰æ›´ã¯ã€Œç·šå½¢ã¾ãŸã¯æŒ‡æ•°ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã€ã§è¡Œã„ã¾ã™ã€‚

### LFO ã®å‘¨æœŸã¯çŸ­ã™ãã‚‹ã¨ãƒã‚¤ã‚ºåŒ–ã™ã‚‹

| å‘¨æœŸ | çµæœ |
|------|------|
| < 0.1ç§’ | ã€Œéœ‡ãˆã€â†’ã€Œãƒã‚¤ã‚ºã€ã¨ã—ã¦èã“ãˆã‚‹ |
| 0.5ã€œ4ç§’ | å¿ƒåœ°ã‚ˆã„ã€Œã‚†ã‚‰ãã€ |
| > 10ç§’ | ã‚†ã£ãã‚Šã¨ã—ãŸã€Œã†ã­ã‚Šã€ |

**TsukiSoundæ¨å¥¨**: 0.5ç§’ã€œ4ç§’ã®ã‚†ã‚‰ã

### Float ã®å¾®ç´°æºã‚Œï¼ˆdriftï¼‰ã‚’å¸åã™ã‚‹

è¨ˆç®—çµæœãŒ Â±1ã‚µãƒ³ãƒ—ãƒ«æºã‚‰ã„ã§ã‚‚å®‰å…¨ãªã‚ˆã†ã«è¨­è¨ˆã—ã¾ã™ï¼š
- softClip ã§æŒ¯å¹…ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’é˜²æ­¢
- é–¾å€¤ã‚’è¨­ã‘ã¦æ¥µç«¯ãªå€¤ã‚’ä¸¸ã‚ã‚‹

---

## 4. Structural Smoothnessï¼ˆæ§‹é€ ãƒ¬ãƒ™ãƒ«ã§ã®æ»‘ã‚‰ã‹ã•ï¼‰

### ã€Œã„ããªã‚Šå¤‰ã‚ã‚‹ã€æ§‹é€ ã‚’è¨­è¨ˆæ®µéšã§æ’é™¤ã™ã‚‹

ä»¥ä¸‹ã‚’**é€”ä¸­ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨å¿…ãšç ´ç¶»**ã—ã¾ã™ï¼š

- Layeræ•°
- Harmonicsæœ¬æ•°
- FilterçŠ¶æ…‹ï¼ˆOn/Offï¼‰

å¿…è¦ãªã‚‰ã€Œæ¬¡ã®å°ç¯€ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã€ãªã©ã€éŸ³æ¥½çš„ãªå¢ƒç•Œã«åˆã‚ã›ã¾ã™ã€‚

### éŸ³é‡ã‚¼ãƒ­ã«ãªã‚‹ç›´å‰ã® "ãƒãƒ„éŸ³" ã‚’é¿ã‘ã‚‹æ§‹é€ 

TsukiSoundã§ã¯ä»¥ä¸‹ã§è§£æ±ºæ¸ˆã¿ï¼š
- `fadeEnabled` ãƒ•ãƒ©ã‚°ã§å†ç”Ÿé–‹å§‹æ™‚ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–
- `playbackSessionId` ã§å¤ã„ã‚¿ã‚¹ã‚¯ã‹ã‚‰ã®volume=0è¨­å®šã‚’ç„¡è¦–

### ãƒ•ã‚£ãƒ«ã‚¿ Q å€¤ã¯æœ€å±é™ºé ˜åŸŸ

- Q ã‚’æ€¥ã«ä¸Šã’ã‚‹ã¨ä¸€æ°—ã«ç™ºæŒ¯ã™ã‚‹
- å¤‰åŒ–æ™‚ã¯ 100ã€œ300ms ã® smoothing ãŒå¿…é ˆ
- æ¥µç«¯ãªQå€¤ï¼ˆ10ä»¥ä¸Šï¼‰ã¯é¿ã‘ã‚‹

---

## 5. Common Failure Patternsï¼ˆã‚ˆãã‚ã‚‹æ»‘ã‚‰ã‹ã•ã®ç ´ç¶»ï¼‰

| ç ´ç¶»ä¾‹ | åŸå›  | å¯¾ç­– |
|-------|------|------|
| ãƒ‘ãƒãƒ‘ãƒéŸ³ï¼ˆã‚¯ãƒªãƒƒã‚¯ï¼‰ | attack=0 / releaseæ€¥å¤‰ / ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹ç„¡è¦– | attack/releaseå›ºå®šãƒ»ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹åˆã‚ã› |
| ã‚¹ãƒ¼ãƒƒã¨å¸ã„è¾¼ã¾ã‚Œã™ãã‚‹ | ãƒ•ã‚§ãƒ¼ãƒ‰ãŒé•·ã™ã | 3ã€œ20msã«èª¿æ•´ |
| ãƒœãƒ•ãƒƒã¨ã„ã†ãƒã‚¤ã‚º | Filter ã® cutoff/Q ã®ã‚¸ãƒ£ãƒ³ãƒ— | ç·©ã‚„ã‹ãª smoothing (100-300ms) |
| æºã‚ŒãŒç²—ã„/ã‚¬ã‚¿ã‚¬ã‚¿ã™ã‚‹ | LFOå‘¨æœŸãŒçŸ­ã™ã | 0.5ç§’ä»¥ä¸Šã« |
| ãƒ¡ãƒ­ãƒ‡ã‚£ã®å°¾ãŒãƒ–ãƒ„åˆ‡ã‚Œ | EnvelopeãŒçŸ­ã™ã | releaseã‚’0.1ã€œ0.2sã« |
| è¤‡æ•°éŸ³é‡ãªã‚‹ã¨æ­ªã‚€ | æŒ¯å¹…ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ | softClipã‚’æœ€çµ‚å‡ºåŠ›ã«é©ç”¨ |

---

## 6. TsukiSound Implementationï¼ˆå†…éƒ¨å®Ÿè£…ï¼‰

### SignalEnvelopeUtils

```swift
// å‘¨æ³¢æ•°ã«å¿œã˜ãŸã‚¢ã‚¿ãƒƒã‚¯æ™‚é–“ã‚’è‡ªå‹•å–å¾—
let attack = SignalEnvelopeUtils.AttackTime.recommended(for: frequency)

// æ»‘ã‚‰ã‹ãªã‚¨ãƒ³ãƒ™ãƒ­ãƒ¼ãƒ—ï¼ˆsinÂ²ã‚¢ã‚¿ãƒƒã‚¯ + æŒ‡æ•°ãƒ‡ã‚£ã‚±ã‚¤ + cosÂ²ãƒªãƒªãƒ¼ã‚¹ï¼‰
let env = SignalEnvelopeUtils.smoothEnvelope(
    t: dt,
    duration: noteDuration,
    attack: attack,
    decay: 2.0,
    releaseTime: 0.15
)

// ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ï¼ˆæŒ¯å¹…ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼é˜²æ­¢ï¼‰
return SignalEnvelopeUtils.softClip(output)
```

### SessionID åˆ¶å¾¡

```swift
// å¤ã„ã‚¿ã‚¹ã‚¯ãŒ volume ã‚’ 0 ã«æˆ»ã™ç ´ç¶»ã‚’é˜²ã
guard fadeSessionId == self.playbackSessionId else {
    timer.invalidate()
    return
}
```

### fadeEnabled ãƒ•ãƒ©ã‚°

```swift
// å†ç”Ÿé–‹å§‹æ™‚ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚’ä¸€æ™‚ç„¡åŠ¹åŒ–
public func play(preset: UISoundPreset) throws {
    fadeEnabled = false
    fadeTimer?.invalidate()
    fadeTimer = nil
    // ...
}
```

---

## 7. Quick Checklist

éŸ³æºå®Ÿè£…æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼š

- [ ] `attack >= 0.03s`ï¼ˆé«˜éŸ³ï¼‰, `>= 0.06s`ï¼ˆä¸­éŸ³ï¼‰, `>= 0.12s`ï¼ˆä½éŸ³ï¼‰
- [ ] `release` ã¯éŸ³æ¥½çš„ã«è‡ªç„¶ãªé•·ã•ï¼ˆ0.1ã€œ0.2sç¨‹åº¦ï¼‰
- [ ] Filter ã® cutoff/Q ã¯æ€¥å¤‰ã—ãªã„
- [ ] LFOå‘¨æœŸã¯ 0.5ç§’ä»¥ä¸Š
- [ ] Harmonicsæœ¬æ•°ã‚’é€”ä¸­ã§å¤‰ãˆãªã„
- [ ] æœ€çµ‚å‡ºåŠ›ã« `softClip` ã‚’é©ç”¨
- [ ] è¤‡æ•°éŸ³ã®ãƒŸãƒƒã‚¯ã‚¹æ™‚ã¯ã‚²ã‚¤ãƒ³ã‚’æ§ãˆã‚ã«

---

## 8. High Frequency Gain Reductionï¼ˆé«˜éŸ³åŸŸã‚²ã‚¤ãƒ³èª¿æ•´ï¼‰

### å•é¡Œ: é«˜éŸ³åŸŸã®ã€Œã‚­ãƒ¼ãƒ³ã€

ãƒ‡ã‚¸ã‚¿ãƒ«ã‚·ãƒ³ã‚»ã‚·ã‚¹ã§ã¯ã€é«˜éŸ³åŸŸï¼ˆ700Hzä»¥ä¸Šï¼‰ã§å€éŸ³ãŒå¼·èª¿ã•ã‚Œã‚‹ã¨ã€Œã‚­ãƒ¼ãƒ³ã€ã¨ã„ã†é‹­ã„éŸ¿ããŒç™ºç”Ÿã—ã‚„ã™ã„ã€‚ç‰¹ã« `richSine` ã®ã‚ˆã†ãªå€éŸ³ã‚’å«ã‚€éŸ³è‰²ã§é¡•è‘—ã€‚

### è§£æ±ºç­–: å‹•çš„ã‚²ã‚¤ãƒ³æ¸›è¡°

å‘¨æ³¢æ•°ã«å¿œã˜ã¦ã‚²ã‚¤ãƒ³ã‚’è‡ªå‹•çš„ã«æ¸›è¡°ã•ã›ã‚‹ï¼š

```swift
// é«˜éŸ³åŸŸã®ã‚²ã‚¤ãƒ³èª¿æ•´ (600Hzä»¥ä¸Šã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ)
// pureSineã§ã‚‚é«˜å‘¨æ³¢ã¯è€³ã«åˆºã•ã‚Šã‚„ã™ã„ãŸã‚ã€å¼·ã‚ã«æ¸›è¡°
if note.freq >= 600.0 {
    let maxFreq: Float = 1318.51  // E6
    let minFreq: Float = 600.0
    let reductionRatio = min(1.0, (note.freq - minFreq) / (maxFreq - minFreq))
    // æœ€é«˜éŸ³åŸŸã§æœ€å¤§35%ã®æ¸›è¡°
    let highFreqReduction = 1.0 - reductionRatio * 0.35
    effectiveGain *= highFreqReduction
}
```

**Lookup Tableï¼ˆé«˜éŸ³åŸŸã‚²ã‚¤ãƒ³æ¸›è¡°ï¼‰**:
```
Frequency   | Reduction | Effective Gain (base 0.28)
------------|-----------|---------------------------
< 600Hz     |    0%     | 0.280
  600Hz     |    0%     | 0.280
  700Hz     |   ~5%     | 0.266
  880Hz (A5)|  ~14%     | 0.241
 1046Hz (C6)|  ~22%     | 0.218
 1318Hz (E6)|   35%     | 0.182
```

### ãªãœã“ã®æ‰‹æ³•ãŒæœ‰åŠ¹ã‹

1. **å¿ƒç†éŸ³éŸ¿å­¦**: äººé–“ã®è€³ã¯é«˜éŸ³åŸŸã«æ•æ„Ÿï¼ˆFletcher-Munsonæ›²ç·šï¼‰
2. **å€éŸ³ã®ç´¯ç©**: é«˜å‘¨æ³¢ã»ã©å€éŸ³ãŒå¯è´åŸŸã‚’è¶…ãˆã€ä¸å¿«ãªæ­ªã¿ã«å¤‰ã‚ã‚‹
3. **æ»‘ã‚‰ã‹ãªæ¸›è¡°æ›²ç·š**: æ€¥ã«éŸ³é‡ãŒå¤‰ã‚ã‚‰ãªã„ãŸã‚ã€è‡ªç„¶ãªè´æ„Ÿã‚’ç¶­æŒ

---

## 9. GymnopÃ©die Implementation Example

`GymnopedieMainMelodySignal.swift` ã§ã®å®Ÿè£…ä¾‹ï¼š

```swift
// æ»‘ã‚‰ã‹ã•æ–¹é‡ï¼ˆSignalEnvelopeUtils guideæº–æ‹ ï¼‰:
// - ä½éŸ³(200Hzä»¥ä¸‹): attack 120msä»¥ä¸Š
// - ä¸­éŸ³(200-500Hz): attack 60msä»¥ä¸Š
// - é«˜éŸ³(500Hzä»¥ä¸Š): attack 30msä»¥ä¸Š

let melodyAttack: Float = 0.15   // é«˜éŸ³ãƒ¡ãƒ­ãƒ‡ã‚£ç”¨ï¼ˆé‹­ã•ã‚’æŠ‘ãˆã‚‹ï¼‰
let melodyDecay: Float = 4.5     // legatoæ„Ÿã‚’å¼·åŒ–ã€å„ªé›…ãªæ¸›è¡°

let bassAttack: Float = 0.15     // ä½éŸ³ã¯é•·ã‚ã«ï¼ˆæ¨å¥¨120ms+ï¼‰
let bassDecay: Float = 3.5       // åºŠæ„Ÿã‚’é•·ãæŒç¶š

let chordAttack: Float = 0.10    // ä¸­éŸ³åŸŸã‚‚æ»‘ã‚‰ã‹ã«ï¼ˆæ¨å¥¨60ms+ï¼‰
let chordDecay: Float = 2.5      // éŸ¿ãã‚’é•·ã
```

### é«˜éŸ³åŸŸã‚²ã‚¤ãƒ³èª¿æ•´ã®é©ç”¨

```swift
private func sampleMelody(at t: Float) -> Float {
    // ...
    var effectiveGain = isClimax ? melodyGain * 1.15 : melodyGain

    // é«˜éŸ³åŸŸã®ã‚²ã‚¤ãƒ³èª¿æ•´ (600Hzä»¥ä¸Šã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ)
    // pureSineã§ã‚‚é«˜å‘¨æ³¢ã¯è€³ã«åˆºã•ã‚Šã‚„ã™ã„ãŸã‚ã€å¼·ã‚ã«æ¸›è¡°
    if note.freq >= 600.0 {
        let maxFreq: Float = 1318.51  // E6
        let minFreq: Float = 600.0
        let reductionRatio = min(1.0, (note.freq - minFreq) / (maxFreq - minFreq))
        let highFreqReduction = 1.0 - reductionRatio * 0.35
        effectiveGain *= highFreqReduction
    }
    // ...
}
```

---

## 10. Related Documents

- `_guide-chord-voicing.md` â€” å’ŒéŸ³ã®ç¾ã—ã„éŸ¿ã‹ã›æ–¹ï¼ˆéšæ®µå¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ãƒ‡ãƒãƒ¥ãƒ¼ãƒ³ï¼‰
- `_guide-signal-envelope-utils.md` â€” SignalEnvelopeUtils APIè©³ç´°
- `_guide-audio-seamless-loop-generation.md` â€” ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãƒ«ãƒ¼ãƒ—ã®ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹å‡¦ç†
- `_guide-audio-system-impl.md` â€” ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å®Ÿè£…
- `_guide-transpose.md` â€” ç§»èª¿ã®æ­£ã—ã„å®Ÿè£…æ–¹æ³•
- `architecture/_arch-audio-parameter-safety-rules.md` â€” ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®‰å…¨ãƒ«ãƒ¼ãƒ«
- `report/report-audio-distortion-noise.md` â€” æ­ªã¿ãƒ»é›‘éŸ³ã®RCA
- `runbook/_2025-11-29_audio_playback_volume_corruption_fix.md` â€” éŸ³é‡ç ´æå•é¡Œã®è§£æ±º

---

## Revision History

| Date | Version | Change |
|------|---------|--------|
| 2025-11-30 | 1.3 | Related Documentsã«_guide-chord-voicing.mdã¨_guide-transpose.mdã‚’è¿½åŠ  |
| 2025-11-30 | 1.2 | é«˜éŸ³åŸŸã‚²ã‚¤ãƒ³èª¿æ•´ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ã€GymnopÃ©dieå®Ÿè£…ä¾‹æ›´æ–° |
| 2025-11-30 | 1.1 | æ»‘ã‚‰ã‹ã•å®šç¾©ãƒ»3å¤§ãƒ«ãƒ¼ãƒ«ãƒ»ã‚¼ãƒ­ã‚¯ãƒ­ã‚¹å›³ãƒ»Lookup Tableè¿½åŠ  |
| 2025-11-30 | 1.0 | åˆç‰ˆä½œæˆ |
